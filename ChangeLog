1999-03-18  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* lib/vx68k/dos.cc: Use I and VL instead of assert and fprintf.

	* configure.in: Add checks for Nana.

	* include/debug.h: New file.
	* include/Makefile.am: Add comments.
	(noinst_HEADERS): Add the new file.

	* lib/vm68k/execunit.cc (unlk_a): New function.
	(install_instructions): Set operation words to the new function.

	* lib/vx68k/dos.cc (close): New function.
	(dos): Set operation word to the new function.

	* lib/vm68k/execunit.cc (movew_absl_d, tstw_d, beq,
	movew_d_predec): New functions.
	(install_instructions): Set operation words to the new functions.

	* lib/vm68k/execunit.cc (moveb_postinc_postinc): Renamed from
	moveb_postint_postinc.  Update all referrers.
	(moveb_postinc_postinc, movel_a_predec): Update the condition
	codes.
	(movew_d_absl): Fix the trace output.
	Modify comments.

	* lib/vx68k/dos.cc (open, print): Output system call names.
	(load_executable): Set part of PSP.

	* lib/vm68k/execunit.cc (clrw_predec, movew_d_absl, moveql_d): Use
	status_register::set_cc.

	* lib/vm68k/statusreg.cc (set_cc): New function.
	(eq, lt): Use result.

	* include/vm68k/cpu.h (class status_register): Changed from struct.

	* lib/vm68k/execunit.cc (execute, bge, bne, bra, bsr,
	lea_offset_a, lea_absl_a, link_a, movew_d_absl, moveml_r_predec,
	pea_absl): Use execution_context::fetchw.

	* include/vm68k/cpu.h (class execution_context): Add fetchw and
	fetchl.

	* lib/vm68k/execunit.cc (execute, bge, bne, bra, bsr, clrw_predec,
	lea_offset_a, lea_absl_a, link_a, moveb_postinc_postinc,
	movew_a_absl, movel_a_predec, movel_postinc_a, moveml_r_predec,
	pea_absl, rts): Use execution_context::program_fc/data_fc.

	* include/vm68k/cpu.h (class execution_context): Changed from
	struct.
	(class execution_context): Add program_fc and data_fc().

	* lib/vm68k/addrspace.cc: Modify comments.
	(getb_signed, getw_signed, getl_signed): Removed.

	* lib/vm68k/execunit.cc (bge, bne, lea_offset_a, link): Use
	extsw/extsb instead of getw_/getb_signed.
	(link_a): Renamed from link.  Update all referrers.

	* lib/vm68k/addrspace.cc: New file.
	* lib/vm68k/Makefile.am (libvm68k_a_SOURCES): Add the new file.
	* lib/vm68k/memory.cc: Move address_space methods to
	addrspace.cc.

	* lib/vm68k/memory.cc (read, write, getb, putb, getw, putw, getl,
	putl): Remove throw-specs.
	(getb, putb, getw, putw): Change the value types to unsigned int.
	* include/vm68k/memory.h (class address_space): Updated.

1999-03-16  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* lib/vm68k/execunit.cc (bra, bsr): Use extsw and extsb to make
	displacements.
	(bra): Fix debug output.

	* lib/vm68k/statusreg.cc (lt): New function.

	* lib/vm68k/execunit.cc (bge): Do test condition code.

	* lib/vx68k/dos.cc (open): Make the d0 value unsigned.

	* lib/vm68k/statusreg.cc (eq): Invert the return value to debug.

	* include/vm68k/cpu.h (extsb, extsw): New functions.
	(status_register): Fix ne to invert its return value.
	(status_register): Add lt and ge.

	* lib/vm68k/execunit.cc (movew_d_absl, bge, bra, moveql_d): New
	functions.
	(install_instructions): Set the new instructions to the operation
	words.

	* lib/vx68k/dos.cc (open): New function.
	(dos): Set the new system call to the operation word.

1999-03-15  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* lib/vm68k/execunit.cc (addqw_a, subql_a): Move the register
	number extraction earlier.

	* lib/vm68k/memory.cc (getb_signed, getw_signed, getl_signed):
	Cast non-negative values explicitly.
	(getb_signed, getw_signed, getl_signed): Remove throw-specs.
	Update the class-def too.

	* include/vm68k/cpu.h (registers): Renamed from cpu_regs.  Update
	all users.

	* lib/vm68k/execunit.cc (bne, bsr, lea_offset_a, link): Use
	address_space::getw_signed.

	* include/vm68k/memory.h (class address_space): Add signed get
	methods.
	* lib/vm68k/memory.cc (getb_signed, getw_signed, getl_signed): New
	functions.

	* TODO: Modifed.

	* README: Modified.

	* NEWS: Modified.

	* lib/vm68k/statusreg.cc: New file.
	* lib/vm68k/Makefile.am (libvm68k_a_SOURCES): Add the new file.

	* lib/vm68k/execunit.cc (bne, subql_a, clrw_predec, pea_absl): New
	functions.
	(install_instructions): Set the new instructions.

	* acconfig.h: Add _REENTRANT.
	* configure.in: Define _REENTRANT.

	* Move libvm68k to lib/vm68k and libvx68k to libvx68k.
	* lib/Makefile.am: New file.
	* Makefile.am (SUBDIRS): Replace libvm68k and libvx68k with lib.
	(vx68k_LDADD): Adjust the directories.
	* configure.in: Change the AC_OUTPUT files.  Change the AC_INIT
	test file.

	* include/vm68k/cpu.h: Modify comments.
	(status_register): New class.
	(user_cpu_regs): Removed.
	(cpu_regs): Reconstruct members.  Update all users.

1999-03-13  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* main.cc: Modify comments.

	* TODO: Modified.

	* README: Modified.

	* libvm68k/execunit.cc: Modify comments.
	(addqw_a, rts, movel_postinc_a, lea_offset_a,
	moveb_postinc_postinc): New function.
	(install_instructions): Set new instructions for operation words.
	(bsr): Fix the write address

	* libvm68k/execunit.cc: Print instructions only ifdef TRACE_STEPS.

	* acconfig.h: Add new macros.

	* configure.in: Define _GNU_SOURCE.
	Add `--enable-step-trace'.

	* main.cc: Modify comments.
	(_): New macro.
	(parse_options): New function.
	(main): Parse options via parse_options and handle options.
	(main): Handle unhandled exceptions.

	* README: Modified.

	* libvm68k/execunit.cc (bsr): Print absolute address.
	(lea_absl_a, link, mmove_l_a_predec, movem_l_r_predec): Use the
	MIT syntax to print instead of the Motorola syntax.
	(movel_a_predec): Renamed from move_l_a_predec.  Update all
	referrers.
	(moveml_r_predec): Renamed from movem_l_r_predec.  Update all
	referrers.

1999-03-12  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* libvx68k/dos.cc: Remove namespace blocks.
	(print): New function.
	(dos): Set &print.

	* libvx68k/memory.cc: Modify comments.
	(getb, putb): Replace abort with real code.

	* libvm68k/memory.cc (getb, putb): New function.

	* libvm68k/execunit.cc: Modify comments.
	(bsr): New function.
	(install_instructions): Set &bsr.

1999-03-11  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* libvm68k/Makefile.am: Add comments.

	* Makefile.am (vx68k_SOURCES): Renamed from x68v_SOURCES.
	(vx68k_LDADD): Likewise.

	* Rename the vx68k and vm68k directories to libvx68k and libvm68k
	respectively.  Update all refs.
	
	* configure.in: Change the AC_INIT test file.

	* main.cc: Moved from vx68v/main.cc.
	* Makefile.am (INCLUDES, bin_PROGRAMS, x68k_SOURCES,
	x68v_LDADD): Added.
	* vx68k/Makefile.am: Modify comments.
	(bin_PROGRAMS, vx68k_SOURCES, vx68k_LDADD): Removed.

	* vx68k/dos.cc: Modify comments.

	* vm68k/execunit.cc (link, move_l_a_predec, movem_l_r_predec):
	Store data to memory.

	* vx68k/dos.cc (start): Set a7 to a safe value.

	* vm68k/cpu.cc: Modify comments.

	* vm68k/execunit.cc (move_l_a_predec, lea_absl_a): New function.
	(install_instructions): Set &move_l_a_predec and &lea_absl_a.

	* vm68k/execunit.cc (link): New function.
	(movem_l_r_predec): Renamed from movem_r_postdec.  Update all
	refs.
	(movem_l_r_predec): Add decrements.
	(movem_l_r_predec): Move the PC increment.
	(movem_l_r_predec): Modify the stderr message.
	(install_instructions): Set &link.

	* include/vm68k/cpu.h (user_cpu_regs): Rename members.

	* vm68k/execunit.cc (movem_l_r_postdec): New function.
	(install_instructions): Set instruction.

	* include/vm68k/cpu.h: Make insn_instruction public.

	* vm68k/execunit.cc (exec_unit): Call install_instructions.

	* include/vm68v/cpu.h (class cpu): Replace the instruction table
	with an exec_unit.  Remove all references.
	* vm68k/cpu.cc: Remove namespace block.
	(run): Use exec_unit::execute.
	(set_handlers): Use exec_unit::set_instruction.

	* vm68k/execunit.cc: New file.
	* include/vm68k/cpu.h (class exec_unit): New class.
	* vm68k/Makefile.am (libvm68k_a_SOURCES): Add execunit.cc.

	* vx68k/dos.cc (load_executable): Make address fixup.

	* vm68k/memory.cc (getl, putl): New function.

	* Makefile.am (dist-snapshot): Add `x' to the version number.

1999-02-05  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* vx68k/main.cc (main): Add check for argc.

	* TODO: Updated.

	* NEWS: Updated.

1999-02-03  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* Makefile.am (dist-snapshot): New target.

1998-11-23  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* vx68k/main.cc (main): Update dos::execute call.

	* vx68k/dos.cc (start): Add argument: argv.
	(execute): Likewise.
	* include/vx68k/human.h (class dos): Update.

1998-11-21  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* vx68k/dos.cc (load_executable): Fix reloc_size offset.

1998-11-20  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* Version 0.27.

	* vx68k/Makefile.am (libvx68k_a_SOURCES): Remove loader.cc.
	* vx68k/loader.cc: Removed.

	* vx68k/dos.cc (load_executable): Get header information.

	* vm68k/memory.cc (write): Defined.
	(read): Defined.

	* vx68k/dos.cc (start): Catch an illegal_instruction.
	(load_executable): Try to load executable.

	* vm68k/cpu.cc (illegal_insn): Throw an illegal_instruction.

	* include/vm68k/except.h (struct illegal_instruction): New class.
	(struct zero_divide): New class.
	(struct privilege_violation): New class.

	* vm68k/memory.cc (getw): New function.
	(getl): New function.
	(putw): New function.
	(putl): New function.

	* Version 0.26.

	* include/vm68k/except.h (struct bus_error): Rename member fc to
	status.  All refs changed.
	(struct address_error): New class.

	* vm68k/memory.cc (READ): Removed.  All uses replaced with
	bus_error::READ.
	(WRITE): Removed.  All uses replaced with bus_error::WRITE.

	* include/vm68k/except.h (exception): Add WRITE and READ enum.

	* vm68k/memory.cc (address_space::set_pages): Renamed from
	set_memory_pages.  Change the first and the second arguments'
	types.  All refs changed too.

	* include/vm68k/Makefile.am (noinst_HEADERS): Add except.h.
	* include/vm68k/except.h: New file.
	(struct exception): Moved from types.h.
	(struct bus_error): Moved from memory.h.

	* vm68k/cpu.cc (set_pc): #if'd out.

	* include/vm68k/cpu.h (class cpu): Remove member function set_pc.

	* vm68k/memory.cc (address_space::putw): Defined.

	* vx68k/memory.cc (main_memory_page::getw): Fix test condition.
	(main_memory_page::putw): Store value into array.

	* vx68k/main.cc (main): Rewritten with class vx68k::human::dos.

	* vx68k/Makefile.am (libvx68k_a_SOURCES): Add dos.cc.
	* vx68k/dos.cc: New file.

	* include/vm68k/cpu.h (VM68K_CPU_H): Fix typo.

	* include/vx68k/Makefile.am (noinst_HEADERS): Add human.h.
	* include/vx68k/human.h (human): New file.

	* vm68k/cpu.cc (illegal_insn): Output message.

	* vx68k/memory.cc (main_memory_page): Allocate array.
	(~main_memory_page): Deallocate array.
	(getw): Return value.

	* include/vx68k/memory.h (memory_page): Add members: end and
	array.

	* include/vx68k/memory.h (class address_space): Renamed from
	memory.  All references changed.
	* include/vm68k/memory.h (class address_space): Likewise.

	* vm68k/memory.cc (set_memory_pages): Defined.

	* vx68k/Makefile.am (libvx68k_a_SOURCES): Add memory.cc.
	* vx68k/memory.cc: New file.

	* include/vm68k/types.h (namespace types): New namespace
	containing intX and uintX typedefs.

	* vx68k/main.cc (main): Add constructor argument for mem.
	* include/vx68k/memory.h (memory): Add member main_memory.
	(class main_memory_page): New class.

	* vx68k/main.cc (main): Set PC.

	* include/vm68k/cpu.h (struct user_cpu_regs): Rename member r to
	gr.

	* vx68k/Makefile.am (libvx68k_a_SOURCES): Add loader.cc.
	* vx68k/loader.cc: New file.

	* Version 0.25.

	* vm68k/cpu.cc (run): Modify display format for bus error.

	* vm68k/memory.cc (READ): New const.
	(WRITE): New const.
	(read): Add READ to fc.
	(getb): Likewise.
	(getw): Likewise.
	(write): Add WRITE to fc.
	(putb): Likewise.
	(putw): Likewise.

	* vx68k/main.cc (main): Update use of cpu.

	* vm68k/cpu.cc (cpu): Remove argument.
	(run): Add argument ec.
	(set_pc): #if'd out code.
	(set_exception_listener): Likewise.

	* include/vm68k/cpu.h (class cpu): Remove member context.

	* include/vm68k/memory.h (struct bus_error): Add base class
	exception.
	* include/vm68k/types.h (struct exception): New class.
	(VM68K_TYPES_H): Fix typo.
	Test UINT_MAX instead of INT_MAX.

	* vm68k/cpu.cc (run): Display fc and address of bus error.

	* vm68k/memory.cc (bus_error): New constructor.  Update all
	construction.

	* include/vm68k/memory.h (struct bus_error): Add members.

	* vx68k/main.cc (main): Remove abort.

	* vm68k/cpu.cc (run): Catch bus_error.

	* vm68k/memory.cc: Add using namespace std.
	(getl): Added.
	(putl): Added.
	(read): New method.
	(write): New method.
	(getb): New method.
	(getw): [class bus_error_page] New method.
	(putb): New method.
	(putw): New method.
	(getw): [class memory] Use page_table.
	(memory): Fill page_table with &default_page.

	* include/vm68k/memory.h (PAGE_SHIFT): Renamed from
	PAGE_SIZE_SHIFT.
	(PAGE_SIZE): Bug fix.
	(MEMORY_SHIFT): New const.
	(NPAGES): New const.
	(struct memory_page): Rename methods read8 to getb, etc.
	(class memory): Likewise.
	(class bus_error_page): New class.
	(class memory): Put iterator in #if 0/#endif.
	(class memory): Add member: default_page.  Rename member page to
	page_table.

1998-11-18  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* TODO: Update.

1998-11-17  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* README: New file.

	* include/vm68k/cpu.h (class cpu): Add description.

	* TODO: New file.

1998-11-14  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* Version 0.24.

	* vx68k/main.cc: Use namespaces.

	* include/vx68k/memory.h: Make namespace vx68k.
	(class memory): Renamed from x68k_memory.

	* include/vm68k/cpu.h: Make namespace vm68k.
	* include/vm68k/memory.h: Likewise.
	* include/vm68k/types.h: Likewise.
	* vm68k/cpu.cc: Likewise.
	* vm68k/memory.cc: Likewise.

	* NEWS: New file.
	* configure.in: Change version numbering.

1998-10-08  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* configure.in (AC_TYPE_SIZE_T): Added.

	* vx68k/main.cc: Undef const and inline.

	* COPYING: New file.
	* INSTALL: New file.

	* Add copyright info to the source files.

	* vm68k/cpu.cc: All refs to substituted members of class cpu
	changed.
	(execution_context): New function.
	(SUPER_PROGRAM): Removed.
	(run): Add some code for function code.
	(run): Change instruction handler call.
	(set_handlers): Fill table using a mask pattern.
	(illegal_insn): Renamed from undefined_insn.  All refs changed.
	(cpu): Change initializers.

	* include/vm68k/cpu.h (struct exception_listener): Renamed from
	interrupt_listener.  All refs changed.
	(struct exception_listener): Add illegal.
	(struct execution_context): New struct.
	(class cpu): Put explicit keyword to the constructor.
	(class cpu): Use execution_context for insn_handler arg.
	(class cpu): Rename undefined_insn to illegal_insn.
	(class cpu): Substitute members with execution_context.

1998-10-07  Kaz Sasayama  <Kaz.Sasayama@hypercore.co.jp>

	* vx68k/main.cc (main): Use x68k_memory and cpu.

	* vm68k/memory.cc (read16): New function.

	* include/vm68k/memory.h (VM68K_MEMORY_H): Fix typo.
	(function_code): New enum.

	* include/vm68k/Makefile.am (noinst_HEADERS): Add types.h and
	memory.h.

	* include/Makefile.am (SUBDIRS): Add vx68k.

	* configure.in (AC_OUTPUT): Add include/vx68k/Makefile.

	* include/vx68k/Makefile.am: New file.
	* include/vx68k/memory.h: New file.

	* ChangeLog: New file.

